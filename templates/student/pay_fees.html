{% extends "base.html" %}

{% block title %}Pay Fees{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Student Portal</h2>
        </div>
        <ul class="sidebar-nav">
            <li><a href="{{ url_for('student.dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('student.pay_fees') }}" class="active">Pay Fees</a></li>
            <li><a href="{{ url_for('student.transaction_history') }}">Transaction History</a></li>
            <li><a href="{{ url_for('student.change_password') }}">Change Password</a></li>
        </ul>
    </aside>
    
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Pay Fees</h1>
        </div>
        
        <div class="payment-card">
            <div class="payment-label">Total Pending Amount</div>
            <div class="payment-amount" id="pendingAmount">₹{{ "{:,.2f}".format(student.fees_pending) }}</div>
            <p style="opacity: 0.9;">Hostel: {{ consultancy.name }}</p>
        </div>
        
        {% if student.fees_pending > 0 %}
        <div class="card">
            <h3 class="card-header">Make Payment</h3>
            <form id="paymentForm">
                <div class="form-group">
                    <label class="form-label">Amount to Pay (₹)</label>
                    <input type="number" id="paymentAmount" class="form-control" 
                           step="0.01" min="1" max="{{ student.fees_pending }}" 
                           placeholder="Enter amount" required 
                           oninput="formatPaymentAmount(this)">
                    <small style="color: var(--text-secondary);">
                        Maximum: ₹{{ "{:,.2f}".format(student.fees_pending) }}
                    </small>
                </div>
                
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary quick-pay-btn" data-amount="5000">Pay ₹5,000</button>
                    <button type="button" class="btn btn-secondary quick-pay-btn" data-amount="10000">Pay ₹10,000</button>
                    <button type="button" class="btn btn-secondary quick-pay-btn" data-amount="{{ student.fees_pending }}">Pay Full Amount</button>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    Proceed to Payment
                </button>
            </form>
        </div>
        
        <div class="card">
            <h3 class="card-header">Payment Information</h3>
            <ul style="margin-left: 1.5rem;">
                <li>Payments are processed securely through Razorpay</li>
                <li>You can pay partial or full amount</li>
                <li>Transaction receipt will be generated immediately</li>
                <li>Payment history can be viewed in Transaction History section</li>
            </ul>
        </div>
        {% else %}
        <div class="card" style="background-color: #d1fae5; border-left: 4px solid #10b981;">
            <h3 style="color: #065f46;">All Fees Paid!</h3>
            <p style="color: #065f46;">You have no pending fees. All payments are complete.</p>
        </div>
        {% endif %}
    </main>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="{{ url_for('static', filename='js/payment.js') }}"></script>
<span id="studentName" style="display:none;">{{ student.full_name }}</span>
<span id="studentEmail" style="display:none;">{{ student.email }}</span>
{% endblock %}